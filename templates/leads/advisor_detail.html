{% extends "base.html" %}

{% block title %}Detail poradce{% endblock %}

{% block content %}
<style>
    .advisor-detail-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 24px;
        align-items: start;
    }

    @media (max-width: 768px) {
        .advisor-detail-grid {
            grid-template-columns: 1fr;
            gap: 16px;
        }

        .advisor-detail-grid > div {
            text-align: left;
        }
    }
</style>

<div class="card">
    <h2>Detail poradce</h2>

    <div class="advisor-detail-grid">
        <div>
            <p><strong>Jméno:</strong> {{ advisor.get_full_name }}</p>

            <p><strong>E-mail:</strong> {{ advisor.email|default:"—" }}</p>

            <p><strong>Telefon:</strong> {{ advisor.phone|default:"—" }}</p>

            {% if user == advisor %}
            <div style="margin-top: 24px; padding-top: 20px; border-top: 1px solid #ddd; display: flex; gap: 12px;">
                <a href="{% url 'edit_profile' %}" class="btn btn-primary">Upravit údaje</a>
                <a href="{% url 'change_password' %}" class="btn btn-secondary">Změnit heslo</a>
            </div>
            {% endif %}
        </div>

        {# Odkazy na leady/obchody s filtry #}
        <div style="padding: 16px; background: #f8f9fa; border-radius: 8px;">
            <h3 style="margin-top: 0; font-size: 16px;">Rychlé odkazy</h3>

            {# Pro advisora - leady/obchody kde je advisor #}
            <div style="margin-bottom: 12px;">
                <strong>Jako poradce:</strong>
                <a href="{% url 'my_leads' %}?advisor={{ advisor.pk }}" class="btn btn-sm" style="margin-left: 8px;">Leady</a>
                <a href="{% url 'deals_list' %}?advisor={{ advisor.pk }}" class="btn btn-sm" style="margin-left: 4px;">Obchody</a>
            </div>

            {# Pro doporučitele - pokud má referrer_profile #}
            {% if referrer_stats %}
            <div style="margin-bottom: 12px;">
                <strong>Jako doporučitel:</strong>
                <a href="{% url 'my_leads' %}?referrer={{ advisor.pk }}" class="btn btn-sm" style="margin-left: 8px;">Leady</a>
                <a href="{% url 'deals_list' %}?referrer={{ advisor.pk }}" class="btn btn-sm" style="margin-left: 4px;">Obchody</a>
            </div>
            {% endif %}
        </div>
    </div>

    <hr>

{% include "leads/includes/date_filter.html" %}

    <h3>Statistiky jako poradce</h3>
    <table>
        <tbody>
            <tr>
                <th>Obdržené leady (od struktury)</th>
                <td>{{ stats.leads_received }}</td>
            </tr>
            <tr>
                <th>Domluvené schůzky</th>
                <td>{{ stats.meetings_planned }}</td>
            </tr>
            <tr>
                <th>Realizované schůzky</th>
                <td>{{ stats.meetings_done }}</td>
            </tr>
            <tr>
                <th>Založené obchody (od struktury)</th>
                <td>{{ stats.deals_created }}</td>
            </tr>
            <tr>
                <th>Dokončené obchody (od struktury)</th>
                <td>{{ stats.deals_completed }}</td>
            </tr>
            <tr>
                <th>Založené obchody (vlastní)</th>
                <td>{{ stats.deals_created_personal }}</td>
            </tr>
            <tr>
                <th>Dokončené obchody (vlastní)</th>
                <td>{{ stats.deals_completed_personal }}</td>
            </tr>
        </tbody>
    </table>

    {% if referrer_stats %}
    <hr>
    <h3>Statistiky jako doporučitel</h3>
    <table>
        <tbody>
            <tr>
                <th>Předané leady</th>
                <td>{{ referrer_stats.leads_sent }}</td>
            </tr>
            <tr>
                <th>Domluvené schůzky</th>
                <td>{{ referrer_stats.meetings_planned }}</td>
            </tr>
            <tr>
                <th>Realizované schůzky</th>
                <td>{{ referrer_stats.meetings_done }}</td>
            </tr>
            <tr>
                <th>Dokončené obchody</th>
                <td>{{ referrer_stats.deals_done }}</td>
            </tr>
        </tbody>
    </table>
    {% endif %}

    <div style="margin-top: 24px;">
        <a href="{% url 'advisors_list' %}" class="btn btn-secondary">← Zpět na seznam poradců</a>
    </div>
</div>
{% endblock %}
