{% extends "base.html" %}

{% block title %}Přehled{% endblock %}

{% block content %}
<div class="card">
    <h2>Přehled</h2>

    <h3>Domluvené schůzky</h3>
    {% if meetings %}
        <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>Termín</th>
                    <th>Klient</th>
                    {% if show_referrer %}<th>Doporučitel</th>{% endif %}
                    {% if show_manager %}<th>Manažer</th>{% endif %}
                    {% if show_office %}<th>Kancelář</th>{% endif %}
                    {% if show_advisor %}<th>Poradce</th>{% endif %}
                </tr>
            </thead>
            <tbody>
            {% for lead in meetings %}
                <tr>
                    <td>{{ lead.meeting_at|date:"d.m.Y H:i" }}</td>
                    <td><a href="{% url 'lead_detail' lead.pk %}">{{ lead.client_name }}</a></td>

                    {% if show_referrer %}
                        <td>{{ lead.referrer }}</td>
                    {% endif %}

                    {% if show_manager %}
                        <td>{{ lead.referrer_manager|default:"—" }}</td>
                    {% endif %}

                    {% if show_office %}
                        <td>{{ lead.referrer_office|default:"—" }}</td>
                    {% endif %}

                    {% if show_advisor %}
                        <td>{{ lead.advisor|default:"—" }}</td>
                    {% endif %}
                </tr>
            {% endfor %}
            </tbody>
        </table>
        </div>
    {% else %}
        <p>Žádné schůzky.</p>
    {% endif %}

    <hr style="margin:16px 0; border:none; border-top:1px solid #eee;">

    <h3>Nově vložené leady</h3>
    {% if new_leads %}
        <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>Klient</th>
                    {% if show_referrer %}<th>Doporučitel</th>{% endif %}
                    {% if show_manager %}<th>Manažer</th>{% endif %}
                    {% if show_office %}<th>Kancelář</th>{% endif %}
                    {% if show_advisor %}<th>Poradce</th>{% endif %}
                    <th>Vytvořeno</th>
                </tr>
            </thead>
            <tbody>
            {% for lead in new_leads %}
                <tr>
                    <td><a href="{% url 'lead_detail' lead.pk %}">{{ lead.client_name }}</a></td>

                    {% if show_referrer %}
                        <td>{{ lead.referrer }}</td>
                    {% endif %}

                    {% if show_manager %}
                        <td>{{ lead.referrer_manager|default:"—" }}</td>
                    {% endif %}

                    {% if show_office %}
                        <td>{{ lead.referrer_office|default:"—" }}</td>
                    {% endif %}

                    {% if show_advisor %}
                        <td>{{ lead.advisor|default:"—" }}</td>
                    {% endif %}

                    <td>{{ lead.created_at|date:"d.m.Y H:i" }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        </div>
    {% else %}
        <p>Žádné nové leady.</p>
    {% endif %}

    <hr style="margin:16px 0; border:none; border-top:1px solid #eee;">

    <h3>Běžící obchody</h3>
    {% if deals %}
        <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>Stav</th>
                    <th>Klient</th>
                    <th>Výše úvěru</th>
                    {% if show_referrer %}<th>Doporučitel</th>{% endif %}
                    {% if show_manager %}<th>Manažer</th>{% endif %}
                    {% if show_office %}<th>Kancelář</th>{% endif %}
                    {% if show_advisor %}<th>Poradce</th>{% endif %}
                    <th>Vytvořeno</th>
                </tr>
            </thead>
            <tbody>
            {% for d in deals %}
                <tr>
                    <td>
                    <span class="badge">{{ d.get_status_display }}</span>
                        {% if d.commission_status == d.CommissionStatus.READY %}
                    <span class="badge badge-ready" style="margin-left:6px;">Provize připravena</span>
                        {% endif %}
                    </td>
                    <td><a href="{% url 'deal_detail' d.pk %}">{{ d.client_name }}</a></td>
                    <td>{{ d.loan_amount }} Kč</td>

                    {% if show_referrer %}
                        <td>{{ d.lead.referrer }}</td>
                    {% endif %}

                    {% if show_manager %}
                        <td>{{ d.lead.referrer_manager|default:"—" }}</td>
                    {% endif %}

                    {% if show_office %}
                        <td>{{ d.lead.referrer_office|default:"—" }}</td>
                    {% endif %}

                    {% if show_advisor %}
                        <td>{{ d.lead.advisor|default:"—" }}</td>
                    {% endif %}

                    <td>{{ d.created_at|date:"d.m.Y H:i" }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        </div>
    {% else %}
        <p>Žádné běžící obchody.</p>
    {% endif %}
</div>
{% endblock %}
