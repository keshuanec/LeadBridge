{% extends "base.html" %}

{% block title %}Detail uživatele{% endblock %}

{% block content %}
<div class="card">
    <h2>Detail uživatele</h2>

    <p><strong>Jméno:</strong> {{ viewed_user.get_full_name }}</p>

    <p><strong>E-mail:</strong> {{ viewed_user.email|default:"—" }}</p>

    <p><strong>Telefon:</strong> {{ viewed_user.phone|default:"—" }}</p>

    <p><strong>Role:</strong> {{ viewed_user.get_role_display }}</p>

    {% if user == viewed_user %}
    <div style="margin-top: 24px; padding-top: 20px; border-top: 1px solid #ddd; display: flex; gap: 12px;">
        <a href="{% url 'edit_profile' %}" class="btn btn-primary">Upravit údaje</a>
        <a href="{% url 'change_password' %}" class="btn btn-secondary">Změnit heslo</a>
    </div>
    {% endif %}

    <hr>

    {% if manager %}
    <p><strong>Manažer:</strong>
        <a href="{% url 'user_detail' manager.pk %}">{{ manager.get_full_name }}</a>
    </p>
    {% endif %}

    {% if office %}
    <p><strong>Kancelář:</strong> {{ office.name }}
        {% if office.owner %}
            (<a href="{% url 'user_detail' office.owner.pk %}">{{ office.owner.get_full_name }}</a>)
        {% endif %}
    </p>
    {% endif %}

    {% if referrer_profile %}
    <p><strong>Přiřazení poradci:</strong>
        {% for advisor in referrer_profile.advisors.all %}
            <a href="{% url 'advisor_detail' advisor.pk %}">{{ advisor.get_full_name }}</a>{% if not forloop.last %}, {% endif %}
        {% empty %}
            —
        {% endfor %}
    </p>
    {% endif %}

    {% if office_stats %}
    <hr>
    <h3>Statistiky kanceláře</h3>
    <table>
        <tbody>
            <tr>
                <th>Předané leady</th>
                <td>{{ office_stats.leads_sent }}</td>
            </tr>
            <tr>
                <th>Domluvené schůzky</th>
                <td>{{ office_stats.meetings_planned }}</td>
            </tr>
            <tr>
                <th>Realizované schůzky</th>
                <td>{{ office_stats.meetings_done }}</td>
            </tr>
            <tr>
                <th>Dokončené obchody</th>
                <td>{{ office_stats.deals_done }}</td>
            </tr>
        </tbody>
    </table>
    {% endif %}

    {% if team_stats %}
    <hr>
    <h3>
        {% if viewed_user.role == "REFERRER_MANAGER" %}
            Statistiky týmu
        {% elif viewed_user.role == "OFFICE" %}
            Statistiky týmu (jako manažer)
        {% endif %}
    </h3>
    <table>
        <tbody>
            <tr>
                <th>Předané leady</th>
                <td>{{ team_stats.leads_sent }}</td>
            </tr>
            <tr>
                <th>Domluvené schůzky</th>
                <td>{{ team_stats.meetings_planned }}</td>
            </tr>
            <tr>
                <th>Realizované schůzky</th>
                <td>{{ team_stats.meetings_done }}</td>
            </tr>
            <tr>
                <th>Dokončené obchody</th>
                <td>{{ team_stats.deals_done }}</td>
            </tr>
        </tbody>
    </table>
    {% endif %}

    {% if referrer_stats %}
    <hr>
    <h3>Statistiky jako doporučitel</h3>
    <table>
        <tbody>
            <tr>
                <th>Předané leady</th>
                <td>{{ referrer_stats.leads_sent }}</td>
            </tr>
            <tr>
                <th>Domluvené schůzky</th>
                <td>{{ referrer_stats.meetings_planned }}</td>
            </tr>
            <tr>
                <th>Realizované schůzky</th>
                <td>{{ referrer_stats.meetings_done }}</td>
            </tr>
            <tr>
                <th>Dokončené obchody</th>
                <td>{{ referrer_stats.deals_done }}</td>
            </tr>
        </tbody>
    </table>
    {% endif %}

    <div style="margin-top: 24px;">
        <a href="javascript:history.back()" class="btn btn-secondary">← Zpět</a>
    </div>
</div>
{% endblock %}
